# Files with duplicate filenames will all be imported,
# but all will copy from the same source.
# This also leads to fewer files being migrated than exist in file_managed,
# and that are listed in drush migrate-status.
id: d7_file
label: Files
migration_tags:
  - Drupal 7
  - Content
  - Files
migration_group: sitenow_migrate

source:
  plugin: files
  constants:
    # Need to update this according to the site being migrated.
    SOURCE_BASE_PATH: 'http://brainworkshop.sites.uiowa.edu/sites/brainworkshop.sites.uiowa.edu/files/'
    DRUPAL_FILE_DIRECTORY: 'public://images/'

destination:
  plugin: 'entity:file'

process:
  filename:
      plugin: get
      source: filename
  source_full_path:
    -
      plugin: concat
      delimiter: /
      source:
        - constants/SOURCE_BASE_PATH
        - uri
    -
      plugin: urlencode
  destination_full_path:
    -
      plugin: concat
      source:
        - constants/DRUPAL_FILE_DIRECTORY
        - filename
    -
      plugin: urlencode
  uri:
    plugin: file_copy
    source:
      - '@source_full_path'
      - '@destination_full_path'
  filemime: filemime
  status: status
  created: timestamp
  changed: timestamp
  # Likely not importing users--set to 0 for anonymous.
  uid:
    plugin: default_value
    default_value: 0
